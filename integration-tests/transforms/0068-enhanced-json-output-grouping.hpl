<?xml version="1.0" encoding="UTF-8"?>
<!--

Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->
<pipeline>
  <info>
    <name>0069-enhanced-json-output-grouping</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2023/11/07 20:56:22.463</created_date>
    <modified_user>-</modified_user>
    <modified_date>2023/11/07 20:56:22.463</modified_date>
  </info>
  <notepads>
  </notepads>
  <order>
    <hop>
      <from>Generate rows</from>
      <to>Clone row</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Clone row</from>
      <to>Fake data</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Fake data</from>
      <to>Sort rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows</from>
      <to>json array of multiple results</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows</from>
      <to>single json result with value array</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>json array of multiple results</from>
      <to>parse json array</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>single json result with value array</from>
      <to>parse single json object</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>parse single json object</from>
      <to>count single objects</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>parse json array</from>
      <to>count objects</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>count objects</from>
      <to>expect 100 rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>count single objects</from>
      <to>expect 10 rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>expect 100 rows</from>
      <to>failed multi json generation</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>expect 10 rows</from>
      <to>failed single json generation</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Clone row</name>
    <type>CloneRow</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <addcloneflag>N</addcloneflag>
    <addclonenum>Y</addclonenum>
    <clonenumfield>group_key</clonenumfield>
    <nrclonefield>key</nrclonefield>
    <nrcloneinfield>N</nrcloneinfield>
    <nrclones>9</nrclones>
    <attributes/>
    <GUI>
      <xloc>368</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Fake data</name>
    <type>Fake</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>random_data</name>
        <topic>username</topic>
        <type>Name</type>
      </field>
    </fields>
    <locale>en</locale>
    <attributes/>
    <GUI>
      <xloc>512</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Generate rows</name>
    <type>RowGenerator</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <length>-1</length>
        <name>trigger_value</name>
        <precision>-1</precision>
        <set_empty_string>Y</set_empty_string>
        <type>String</type>
      </field>
    </fields>
    <interval_in_ms>5000</interval_in_ms>
    <last_time_field>FiveSecondsAgo</last_time_field>
    <limit>10</limit>
    <never_ending>N</never_ending>
    <row_time_field>now</row_time_field>
    <attributes/>
    <GUI>
      <xloc>240</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>${java.io.tmpdir}</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>group_key</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>640</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform>
    <name>count objects</name>
    <type>GroupBy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <add_linenr>N</add_linenr>
    <all_rows>N</all_rows>
    <directory>${java.io.tmpdir}</directory>
    <fields>
      <field>
        <aggregate>amount</aggregate>
        <subject>random_data</subject>
        <type>COUNT_ALL</type>
      </field>
    </fields>
    <give_back_row>N</give_back_row>
    <group>
</group>
    <ignore_aggregate>N</ignore_aggregate>
    <prefix>grp</prefix>
    <attributes/>
    <GUI>
      <xloc>1296</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>count single objects</name>
    <type>GroupBy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <add_linenr>N</add_linenr>
    <all_rows>N</all_rows>
    <directory>${java.io.tmpdir}</directory>
    <fields>
      <field>
        <aggregate>amount</aggregate>
        <subject>random_data</subject>
        <type>COUNT_ALL</type>
      </field>
    </fields>
    <give_back_row>N</give_back_row>
    <group>
</group>
    <ignore_aggregate>N</ignore_aggregate>
    <prefix>grp</prefix>
    <attributes/>
    <GUI>
      <xloc>1296</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>expect 10 rows</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compare>
      <condition>
        <conditions>
</conditions>
        <function>=</function>
        <leftvalue>amount</leftvalue>
        <negated>N</negated>
        <operator>-</operator>
        <value>
          <isnull>N</isnull>
          <length>-1</length>
          <mask>####0;-####0</mask>
          <name>constant</name>
          <precision>0</precision>
          <text>10</text>
          <type>Integer</type>
        </value>
      </condition>
    </compare>
    <send_false_to>failed single json generation</send_false_to>
    <attributes/>
    <GUI>
      <xloc>1456</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>expect 100 rows</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compare>
      <condition>
        <conditions>
</conditions>
        <function>=</function>
        <leftvalue>amount</leftvalue>
        <negated>N</negated>
        <operator>-</operator>
        <value>
          <isnull>N</isnull>
          <length>-1</length>
          <mask>####0;-####0</mask>
          <name>constant</name>
          <precision>0</precision>
          <text>100</text>
          <type>Integer</type>
        </value>
      </condition>
    </compare>
    <send_false_to>failed multi json generation</send_false_to>
    <attributes/>
    <GUI>
      <xloc>1456</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>failed multi json generation</name>
    <type>Abort</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <abort_option>ABORT_WITH_ERROR</abort_option>
    <always_log_rows>Y</always_log_rows>
    <row_threshold>0</row_threshold>
    <attributes/>
    <GUI>
      <xloc>1664</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>failed single json generation</name>
    <type>Abort</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <abort_option>ABORT_WITH_ERROR</abort_option>
    <always_log_rows>Y</always_log_rows>
    <row_threshold>0</row_threshold>
    <attributes/>
    <GUI>
      <xloc>1664</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>json array of multiple results</name>
    <type>EnhancedJsonOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <outputValue>not_grouped_jsons</outputValue>
    <jsonBloc>result</jsonBloc>
    <operation_type>outputvalue</operation_type>
    <use_arrays_with_single_instance>N</use_arrays_with_single_instance>
    <use_single_item_per_group>N</use_single_item_per_group>
    <json_prittified>N</json_prittified>
    <encoding>UTF-8</encoding>
    <addtoresult>N</addtoresult>
    <file>
      <name/>
      <split_output_after>0</split_output_after>
      <extention>json</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <create_parent_folder>N</create_parent_folder>
      <doNotOpenNewFileInit>N</doNotOpenNewFileInit>
    </file>
    <additional_fields>
      <json_size_field/>
    </additional_fields>
    <key_fields>
      <key_field>
        <key_field_name>group_key</key_field_name>
        <key_field_element>group_key</key_field_element>
      </key_field>
    </key_fields>
    <fields>
      <field>
        <name>random_data</name>
        <element>random_data</element>
        <json_fragment>N</json_fragment>
        <is_without_enclosing>N</is_without_enclosing>
        <remove_if_blank>N</remove_if_blank>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>848</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>parse json array</name>
    <type>JsonInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>N</addresultfile>
    <readurl>N</readurl>
    <removeSourceField>N</removeSourceField>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <doNotFailIfNoFile>Y</doNotFailIfNoFile>
    <ignoreMissingPath>Y</ignoreMissingPath>
    <defaultPathLeafToNull>Y</defaultPathLeafToNull>
    <rownum_field/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>random_data</name>
        <path>$.result.*.random_data</path>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <IsAFile>N</IsAFile>
    <valueField>not_grouped_jsons</valueField>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <GUI>
      <xloc>1072</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>parse single json object</name>
    <type>JsonInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>N</addresultfile>
    <readurl>N</readurl>
    <removeSourceField>N</removeSourceField>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <doNotFailIfNoFile>Y</doNotFailIfNoFile>
    <ignoreMissingPath>Y</ignoreMissingPath>
    <defaultPathLeafToNull>Y</defaultPathLeafToNull>
    <rownum_field/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>result</name>
        <path>$.result</path>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>random_data</name>
        <path>$.result.random_data</path>
        <type>JSON</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <IsAFile>N</IsAFile>
    <valueField>forced_into_single_grouped_json</valueField>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <GUI>
      <xloc>1088</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>single json result with value array</name>
    <type>EnhancedJsonOutput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <outputValue>forced_into_single_grouped_json</outputValue>
    <jsonBloc>result</jsonBloc>
    <operation_type>outputvalue</operation_type>
    <use_arrays_with_single_instance>N</use_arrays_with_single_instance>
    <use_single_item_per_group>Y</use_single_item_per_group>
    <json_prittified>N</json_prittified>
    <encoding>UTF-8</encoding>
    <addtoresult>N</addtoresult>
    <file>
      <name/>
      <split_output_after>0</split_output_after>
      <extention>json</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <create_parent_folder>N</create_parent_folder>
      <doNotOpenNewFileInit>N</doNotOpenNewFileInit>
    </file>
    <additional_fields>
      <json_size_field/>
    </additional_fields>
    <key_fields>
      <key_field>
        <key_field_name>group_key</key_field_name>
        <key_field_element>group_key</key_field_element>
      </key_field>
    </key_fields>
    <fields>
      <field>
        <name>random_data</name>
        <element>random_data</element>
        <json_fragment>N</json_fragment>
        <is_without_enclosing>N</is_without_enclosing>
        <remove_if_blank>N</remove_if_blank>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>848</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>
